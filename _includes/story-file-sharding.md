<h2>File Sharding</h2>
<p>Earlier on this page, we mentioned that file sharding is a BitTorrent feature we wanted to include in our application.</p>
<p>The reasons for this include improved distribution and reliability. Multiple users store shards of the files so that if a node containing download information for a shard goes offline, the shard info can be retrieved from a different source.</p>
<p>File sharding also saves bandwidth, where the load of sharing potentially large files is distributed amongst many nodes.</p>
<p>Implementation-wise, upon upload a file is broken into smaller files called “pieces”. A manifest file is then created which keeps a record of all the pieces needed to reassemble a file.</p>

<figure>
  <img src="public/images/file_sharding.png" alt="File sharding">
  <figcaption>The sharding process produces multiple pieces and a manifest file</figcaption>
</figure>

<p>When we upload a file, we create an ID for it by hashing the file’s content. This ID is also used as the filename for the manifest. Users don’t need to know about the manifest and can just search by the original file’s ID.</p>
<p>The .xro extension is added so that we can distinguish between manifest and shard files in our system.</p>
<p>Here we have the contents of a manifest in JSON format, which includes the original file name, the length of the file in bytes and an array containing all of the pieces in sequential order. The ID of each piece is generated by hashing the piece’s contents.</p>

```
  {
    "file_name":"banana.mp4",
    "length":9137395,
    "pieces":[
      "272610812651008498817059664145444816819140431736",
      "255845820650928817902394043384061703021184974492",
      "709124865584808529999187320247131501825035282844",
      "463972141944555281071361859762050722622562309482",
      "665233928362169136349271011451642022996948352498",
      "460767108478119568061824765684889409150273585314",
      "242856439500459087965632547950882773486858003109",
      "1113118586291233368092664992853829437069513635744",
      "55094692080869844054492088107211106202780121432"
    ]
  }
```